# üè¢ API de Gesti√≥n Inmobiliaria - Taller Backend NodeJS

<div align="center">
  
![Node.js](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=nodedotj## #### ‚öôÔ∏è Gesti√≥n Administrativa
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `POST` | `/users` | Crea nuevo usuario | `superadmin` |
| `GET` | `/users` | Lista todos los usuarios | `superadmin` |
| `GET` | `/users/:id` | Obtiene usuario por ID | `superadmin` |
| `PUT` | `/users/:id` | Actualiza usuario por ID | `superadmin` |
| `DELETE` | `/users/:id` | Elimina usuario por ID* | `superadmin` |

*Solo si no tiene propiedades asignadas

---

### 2Ô∏è‚É£ M√≥dulo de Propiedades üè†

#### ÔøΩ Consultas P√∫blicas
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/properties` | Lista todas las propiedades |
| `GET` | `/properties/:id` | Obtiene propiedad por ID |

#### üè° Gesti√≥n de Agente
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `POST` | `/properties/agent` | Crea nueva propiedad | `agente` |
| `PUT` | `/properties/agent/:id` | Actualiza su propiedad | `agente` |
| `DELETE` | `/properties/agent/:id` | Elimina su propiedad** | `agente` |

#### ‚öôÔ∏è Gesti√≥n Administrativa
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `POST` | `/properties/admin` | Crea propiedad (cualquier owner) | `superadmin` |
| `PUT` | `/properties/admin/:id` | Actualiza cualquier propiedad | `superadmin` |
| `DELETE` | `/properties/admin/:id` | Elimina cualquier propiedad** | `superadmin` |

**Elimina autom√°ticamente todas las tareas asociadas

---

### 3Ô∏è‚É£ M√≥dulo de Tareas ÔøΩÔøΩ 

#### üë§ Gesti√≥n de Agente
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `GET` | `/tasks/agent` | Lista sus tareas asignadas | `agente` |
| `GET` | `/tasks/agent/:id` | Obtiene su tarea por ID | `agente` |
| `GET` | `/tasks/property/:propertyId` | Tareas de su propiedad | `agente` |
| `POST` | `/tasks/agent` | Crea tarea en su propiedad | `agente` |
| `PUT` | `/tasks/agent/:id` | Actualiza su tarea | `agente` |
| `DELETE` | `/tasks/agent/:id` | Elimina su tarea | `agente` |

#### ‚öôÔ∏è Gesti√≥n Administrativa
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `GET` | `/tasks/admin` | Lista todas las tareas | `superadmin` |
| `GET` | `/tasks/admin/:id` | Obtiene cualquier tarea | `superadmin` |
| `GET` | `/tasks/admin/property/:propertyId` | Tareas de cualquier propiedad | `superadmin` |
| `POST` | `/tasks/admin` | Crea tarea en cualquier propiedad | `superadmin` |
| `PUT` | `/tasks/admin/:id` | Actualiza cualquier tarea | `superadmin` |
| `DELETE` | `/tasks/admin/:id` | Elimina cualquier tarea | `superadmin` |**Pruebas de Integraci√≥n (Postman)**
üìÅ **Colecci√≥n disponible:** `Inmobiliaria Express - NodeJS.postman_collection.json`

#### üéØ C√≥mo realizar las pruebas:

1. **üìã Importa la colecci√≥n** de Postman en tu workspace
2. **üóÑÔ∏è Inicia la base de datos** con `docker-compose up -d`
3. **üå± Puebla con datos iniciales** ejecutando `bun run db:seed`
4. **üöÄ Inicia la aplicaci√≥n** con `bun run dev`
5. **üìÇ Abre los folders** en la colecci√≥n por m√≥dulo
6. **‚ñ∂Ô∏è Ejecuta las pruebas** de manera secuencial

#### üîß **Variables de Entorno:**
- `{{jwt_token}}` - Token de autenticaci√≥n de agente
- `{{jwt_SuperToken}}` - Token de autenticaci√≥n de superadmin
- `{{test_agent_id}}` - ID del agente de prueba
- `{{base_url}}` - URL base de la API

### üß™ **Pruebas Unitarias**
> üöß **Estado:** Pendiente de implementaci√≥n

**Objetivo:** Cobertura del 80% usando Jest
- **Componentes a probar:** Controladores, servicios, modelos, utilidades
- **Escenarios:** Casos de √©xito y error, validaciones, l√≥gica de negocio
- **Frameworks:** Jest para testing, Supertest para APIs)
![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)
![Express.js](https://img.shields.io/badge/Express.js-000000?style=for-the-badge&logo=express&logoColor=white)
![MongoDB](https://img.shields.io/badge/MongoDB-4EA94B?style=for-the-badge&logo=mongodb&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2CA5E0?style=for-the-badge&logo=docker&logoColor=white)

**Una API RESTful robusta para la gesti√≥n de una agencia inmobiliaria**

*Desarrollada como parte del taller "Backend - NodeJS" de la materia Computaci√≥n en Internet III*

</div>

---

## üìã Tabla de Contenidos

- [üéØ Descripci√≥n del Proyecto](#-descripci√≥n-del-proyecto)
- [üõ†Ô∏è Tecnolog√≠as Utilizadas](#Ô∏è-tecnolog√≠as-utilizadas)
- [üìã Prerrequisitos](#-prerrequisitos)
- [‚ö° Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
- [üöÄ Ejecuci√≥n del Proyecto](#-ejecuci√≥n-del-proyecto)
- [üì° Uso de la API (Endpoints)](#-uso-de-la-api-endpoints)
- [üß™ Pruebas con Postman](#-pruebas-con-postman)
- [‚òÅÔ∏è Despliegue](#Ô∏è-despliegue)
- [üìà Roadmap del Proyecto](#-roadmap-del-proyecto)

---

## üéØ Descripci√≥n del Proyecto

API backend completa para una herramienta interna de una agencia inmobiliaria desarrollada como parte del taller "Backend - NodeJS" de Computaci√≥n en Internet III. La aplicaci√≥n implementa un sistema robusto de gesti√≥n de usuarios, propiedades y tareas con autenticaci√≥n JWT, roles diferenciados y integridad referencial.

### ‚ú® Funcionalidades Implementadas

- **üë• Gesti√≥n de Usuarios:** Sistema completo de CRUD con roles y autenticaci√≥n JWT
- **üîê Autenticaci√≥n y Autorizaci√≥n:** Seguridad basada en JSON Web Tokens con middleware de roles
- **üõ°Ô∏è Roles y Permisos:** Dos niveles de acceso diferenciados:
  - `superadmin`: Control total sobre todos los m√≥dulos (usuarios, propiedades, tareas)
  - `agente`: Gesti√≥n de sus propias propiedades y tareas asignadas
- **üè† Gesti√≥n de Propiedades:** CRUD completo con ownership y control de acceso por roles
- **üìù Gesti√≥n de Tareas:** CRUD completo vinculado a propiedades con asignaci√≥n autom√°tica
- **üîÑ Integridad Referencial:** Cascade delete y validaci√≥n de dependencias
- **‚ö° Optimizaciones:** Filtros combinados en MongoDB y centralizaci√≥n de errores

---

## üõ†Ô∏è Tecnolog√≠as Utilizadas

| Categor√≠a | Tecnolog√≠a |
|-----------|------------|
| **Runtime** | Node.js, Bun |
| **Framework** | Express.js |
| **Lenguaje** | TypeScript |
| **Base de Datos** | MongoDB (Docker) |
| **ODM** | Mongoose |
| **Seguridad** | JWT, bcrypt |
| **Contenedores** | Docker Compose |
| **Arquitectura** | DTOs, Serializers, Middleware |
| **Patrones** | Repository, Service Layer, Error Handling |

---

## üìã Prerrequisitos

Antes de comenzar, aseg√∫rate de tener instaladas las siguientes herramientas:

- ‚úÖ **Node.js:** v20.x o superior (`node -v`)
- ‚úÖ **Bun:** v1.x o superior (`bun -v`)
- ‚úÖ **Docker & Docker Compose:** Aseg√∫rate de que Docker Desktop est√© en ejecuci√≥n
  - `docker --version`
  - `docker-compose --version`
- ‚úÖ **Git:** Para clonar el repositorio

---

## ‚ö° Instalaci√≥n y Configuraci√≥n

### 1Ô∏è‚É£ Instalar Dependencias

```bash
bun install
```

### 2Ô∏è‚É£ Configurar Variables de Entorno

Crea un archivo `.env` en la ra√≠z del proyecto:

```env
# Puerto de la aplicaci√≥n
PORT=3000

# Credenciales y URI de la Base de Datos MongoDB (datos de ejemplo)
MONGO_USER=admin
MONGO_PASSWORD=admin123
MONGO_URI=mongodb://admin:admin123@localhost:27017/inmobiliariaDB?authSource=admin

# Secreto para firmar los JSON Web Tokens
JWT_SECRET=clave_007
```

---

## üöÄ Ejecuci√≥n del Proyecto

### üóÑÔ∏è Iniciar la Base de Datos

```bash
docker-compose up -d
```

> üí° **Tip:** Verifica que el contenedor est√© corriendo con `docker ps`

### üå± Sembrar la Base de Datos (Primera vez)

```bash
bun run db:seed
```

### üî• Iniciar la Aplicaci√≥n

```bash
bun run dev
```

‚úÖ **¬°Listo!** El servidor estar√° corriendo en `http://localhost:3000`

---

## üì° Uso de la API (Endpoints)

> **Base URL:** `http://localhost:3000/api`

### 1Ô∏è‚É£ M√≥dulo de Usuarios ÔøΩ

#### ÔøΩüîì Autenticaci√≥n P√∫blica
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/users/register` | Registra un nuevo usuario (rol: `agente`) |
| `POST` | `/users/login` | Autentica usuario y devuelve JWT |

#### üë§ Perfil Personal
| M√©todo | Endpoint | Descripci√≥n | Auth |
|--------|----------|-------------|------|
| `GET` | `/users/me` | Obtiene perfil del usuario actual | ‚úÖ |
| `PUT` | `/users/me` | Actualiza perfil del usuario actual | ‚úÖ |
| `DELETE` | `/users/me` | Elimina cuenta del usuario actual | ‚úÖ |

#### ÔøΩÔ∏è Gesti√≥n Administrativa
| M√©todo | Endpoint | Descripci√≥n | Roles |
|--------|----------|-------------|--------|
| `POST` | `/users` | Crea nuevo usuario | `superadmin` |
| `GET` | `/users` | Lista todos los usuarios | `superadmin` |
| `GET` | `/users/:id` | Obtiene usuario por ID | `superadmin` |
| `PUT` | `/users/:id` | Actualiza usuario por ID | `superadmin` |
| `DELETE` | `/users/:id` | Elimina usuario por ID | `superadmin` |

---

### 2Ô∏è‚É£ M√≥dulo de Propiedades üè† 

> üöß **Estado:** En desarrollo

---

### 3Ô∏è‚É£ M√≥dulo de Tareas üìã

> üöß **Estado:** En desarrollo

---

## üß™ Pruebas con Postman

üìÅ **Colecci√≥n disponible:** `Inmobiliaria Express - NodeJS.postman_collection.json`

### üéØ C√≥mo realizar las pruebas:

1. **üìã Importa la colecci√≥n** de Postman en tu workspace
2. **üóÑÔ∏è Inicia la base de datos** con `docker-compose up -d`
3. **üå± Puebla con datos iniciales** ejecutando `bun run db:seed`
4. **üöÄ Inicia la aplicaci√≥n** con `bun run dev`
5. **üìÇ Abre los folders** en la colecci√≥n
6. **‚ñ∂Ô∏è Ejecuta las pruebas** de arriba hacia abajo en orden secuencial

> ÔøΩ **Tip:** Las pruebas est√°n organizadas en folders por m√≥dulo. Ejecuta cada folder de manera secuencial para obtener mejores resultados.
- `{{jwt_token}}` - Token de autenticaci√≥n
- `{{jwt_SuperToken}}` - Token de autenticaci√≥n de super usuario
- `{{test_agent_id}}` - ID del agente de prueba

---

## üèóÔ∏è Arquitectura y Caracter√≠sticas T√©cnicas

### üìä **Patrones Implementados**
- **DTO (Data Transfer Objects):** Validaci√≥n y serializaci√≥n de datos
- **Service Layer:** L√≥gica de negocio separada de controladores
- **Repository Pattern:** Abstracci√≥n de acceso a datos
- **Middleware Chain:** Autenticaci√≥n, autorizaci√≥n y manejo de errores

### üîÑ **Integridad Referencial**
- **Cascade Delete:** Eliminar propiedad ‚Üí elimina tareas autom√°ticamente
- **Dependency Validation:** No permite eliminar usuarios con propiedades
- **Ownership Control:** Agentes solo gestionan sus recursos

### ‚ö° **Optimizaciones**
- **Filtros Combinados:** Consultas MongoDB optimizadas
- **Error Handler Centralizado:** Manejo unificado de errores
- **Populate Strategy:** Carga eficiente de relaciones

### üõ°Ô∏è **Seguridad**
- **JWT Authentication:** Tokens seguros con expiraci√≥n
- **Role-based Authorization:** Permisos diferenciados
- **Password Hashing:** bcrypt con salt
- **Input Validation:** Validaci√≥n de entrada en todos los endpoints

---

## ‚òÅÔ∏è Despliegue

> üöß **Estado:** Pendiente de implementaci√≥n

üåê **API Desplegada:** [Pr√≥ximamente]

---

## üìà Estado del Proyecto

### ‚úÖ **M√≥dulos Completados**

#### üë• **M√≥dulo de Usuarios**
- [x] Autenticaci√≥n JWT completa (Login/Register)
- [x] Middlewares de autorizaci√≥n por roles
- [x] CRUD completo con rutas protegidas
- [x] Validaci√≥n de dependencias para eliminaci√≥n
- [x] Serializaci√≥n segura de datos

#### üè† **M√≥dulo de Propiedades**
- [x] Modelo completo con relaciones
- [x] CRUD diferenciado por roles (agente/superadmin)
- [x] Ownership y control de acceso
- [x] Cascade delete de tareas asociadas
- [x] Rutas p√∫blicas y privadas

#### üìã **M√≥dulo de Tareas**
- [x] Sistema completo de tareas vinculadas a propiedades
- [x] Asignaci√≥n autom√°tica basada en ownership
- [x] CRUD diferenciado por roles
- [x] Integridad referencial con propiedades
- [x] Optimizaciones con filtros combinados

### ÔøΩ **Pendientes de Implementaci√≥n**
- [ ] **Pruebas Unitarias:** Cobertura del 80% con Jest
- [ ] **Despliegue en Nube:** Implementaci√≥n en plataforma cloud
- [ ] **Colecci√≥n Postman:** Pruebas de integraci√≥n completas
- [ ] **Documentaci√≥n Adicional:** Diagramas de arquitectura

---

## üìö Cumplimiento de Requisitos

### ‚úÖ **Requisitos Funcionales Implementados**

#### üë• **Gesti√≥n de Usuarios**
- [x] Superadmin puede crear, modificar y eliminar usuarios
- [x] Roles implementados: `superadmin`, `agente` (usuario regular)
- [x] Usuarios autenticados pueden ver/editar su perfil
- [x] Solo superadmin puede gestionar otros usuarios

#### üîê **Autenticaci√≥n y Autorizaci√≥n**
- [x] Sistema JWT completo con middleware de autenticaci√≥n
- [x] Middleware de validaci√≥n de roles para cada operaci√≥n
- [x] Rutas protegidas seg√∫n permisos de usuario

#### üè†üìã **M√≥dulos Interrelacionados**
- [x] **M√≥dulo Propiedades:** CRUD completo con ownership
- [x] **M√≥dulo Tareas:** CRUD vinculado a propiedades
- [x] Relaci√≥n directa entre propiedades y tareas
- [x] Gesti√≥n diferenciada por roles (agente vs superadmin)

#### üîÑ **Caracter√≠sticas Adicionales**
- [x] Integridad referencial (cascade delete, validaci√≥n dependencias)
- [x] Optimizaciones de rendimiento (filtros combinados)
- [x] Error handling centralizado
- [x] Arquitectura escalable con DTOs y Services

### üöß **Elementos Pendientes**
- [ ] **Pruebas Unitarias:** 80% cobertura con Jest
- [ ] **Pruebas Integraci√≥n:** Colecci√≥n Postman completa
- [ ] **Despliegue:** Implementaci√≥n en nube
- [ ] **Documentaci√≥n:** README t√©cnico detallado

---

<div align="center">

<p><strong>Desarrollado para Computaci√≥n en Internet III - Universidad Icesi</strong></p>
<p><em>Taller: Backend NodeJS - Docente: Kevin Rodriguez</em></p>
<p><em>Entrega: Septiembre 2025</em></p>

</div>
  
